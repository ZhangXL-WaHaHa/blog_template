---
title: 网页输出二维码扫描器扫描到的值
date: 2021-04-26
categories:
 - js
 - vue
---

## 原理
二维码是由一个连续的字符通过一定的算法生成的图片，通过微信扫一扫之类的扫描二维码软件，便可以将其原本的字符串值解析出来。二维码扫描器
从本质上来讲，就是一个键盘，解析出二维码或者一维码原本的字符串，模拟敲击键盘逐个的将字符串输入，最后输入enter（13）。

## 实现
了解了二维码扫描器大概的工作原理，便可以很轻松的在网页上输出其扫描到的值。
::: tip
1. 在网页一开始加载的时候就监听键盘输入
2. 相邻两个字符监听到时间不超过一定值，则认定为连接在一起，否则认定第二个字符为全新的值
3. 监听到keycode为13，即按下了enter键，认定为字符输入结束，拿到输入的字符，并在调试打印出来
:::
大致上的思路已经明确了，相关的代码：
```js

```

## 在vue项目中使用
```js
document.onkeydown = function(e) {
      let nextCode
      let nextTime = ''
      const lastTime = this.lastTime
      let code = this.code
      if (window.event) { // IE
        nextCode = e.keyCode
      } else if (e.which) { // Netscape/Firefox/Opera
        nextCode = e.which
      }
      nextTime = new Date().getTime()
      // 字母上方 数字键0-9 对应键码值 48-57; 数字键盘 数字键0-9 对应键码值 96-105
      if ((nextCode >= 48 && nextCode <= 57) || (nextCode >= 96 && nextCode <= 105)) {
        const codes = { '48': 48, '49': 49, '50': 50, '51': 51, '52': 52, '53': 53, '54': 54, '55': 55, '56': 56, '57': 57,
          '96': 48, '97': 49, '98': 50, '99': 51, '100': 52, '101': 53, '102': 54, '103': 55, '104': 56, '105': 57
        }
        nextCode = codes[nextCode]
        nextTime = new Date().getTime()
      }
      // 第二次输入延迟两秒，删除之前的数据重新计算
      if (nextTime && lastTime && nextTime - lastTime > 2000) {
        code = String.fromCharCode(nextCode)
      } else {
        code += String.fromCharCode(nextCode)
      }
      // 保存数据
      this.nextCode = nextCode
      this.lastTime = nextTime
      this.code = code
      // 键入Enter
      if (e.which === 13) {
        // code = $.trim(code) // 去除首尾空格
        if (code.length === 13) {
          console.log('A类条码:' + code)
        } else if (code.length === 23) {
          console.log('B类条码:' + code)
        } else if (code.length === 0) {
          console.log('请输入条码')
        } else {
          console.log('条码不合法：' + code)
        }
        // 键入回车务必清空code值
        this.code = ''
        return false
      }
    }
```